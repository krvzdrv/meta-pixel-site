# üöÄ Release v16.2 - FBQ Interceptor

**–î–∞—Ç–∞:** 2 –¥–µ–∫–∞–±—Ä—è 2024  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready  
**–ü—Ä–∏–º–µ–Ω–µ–Ω–æ –∫:** PL, DE, RO

---

## üéØ –ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ï–ù–ê

### –ò—Å—Ö–æ–¥–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:
```
Product views: 47.2%
Product adds to cart: 0%        ‚ùå –ö–†–ò–¢–ò–ß–ù–û!
Product purchases: 71.4%
```

**–ü—Ä–∏—á–∏–Ω–∞:** Tilda –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç AddToCart —Å **Tilda UID** –≤–º–µ—Å—Ç–æ **External ID**

---

## üîç –ß–¢–û –û–ë–ù–ê–†–£–ñ–ò–õ–ò

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–∫–∞–∑–∞–ª–∞:

1. **Tilda –ù–ï –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ `tstore-cart-add`**
   - –ù–∞—à –∫–æ–¥ v16.1 –∂–¥–∞–ª —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ
   - –°–æ–±—ã—Ç–∏–µ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏–ª–æ ‚Üí –Ω–∞—à AddToCart –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª—Å—è

2. **Tilda –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç fbq –ù–ê–ü–†–Ø–ú–£–Æ:**
   ```javascript
   fbq('track', 'AddToCart', {
     content_ids: ['578757699002']  // ‚Üê Tilda UID (–ù–ï–¢ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ!)
   });
   ```

3. **–†–µ–∑—É–ª—å—Ç–∞—Ç:**
   - Meta –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è —Å ID –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ –∫–∞—Ç–∞–ª–æ–≥–µ
   - Match Rate: 0%

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï v16.2

### FBQ Interceptor (–ü–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫ fbq)

**–ü–æ–¥—Ö–æ–¥:** –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –≤—ã–∑–æ–≤—ã `fbq()` –∏ –∏—Å–ø—Ä–∞–≤–ª—è–µ–º –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –ª–µ—Ç—É

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

```javascript
// 1. –°–æ–∑–¥–∞–µ–º reverse mapping –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
window.tildaUidToExternalId = {};
for (var parentUid in window.productCatalogMapping) {
  for (var variantUid in mapping.variants) {
    tildaUidToExternalId[variantUid] = mapping.variants[variantUid];
  }
}

// 2. –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º fbq
var _originalFbq = window.fbq;
window.fbq = function() {
  var eventName = arguments[1];
  var eventData = arguments[2];
  var eventOptions = arguments[3];

  // 3. –î–µ—Ç–µ–∫—Ç–∏—Ä—É–µ–º AddToCart –æ—Ç Tilda (–±–µ–∑ eventID)
  if (eventName === 'AddToCart' && !eventOptions?.eventID) {
    var tildaUid = eventData.content_ids[0];
    var externalId = tildaUidToExternalId[tildaUid];

    if (externalId) {
      // 4. –ò–°–ü–†–ê–í–õ–Ø–ï–ú!
      eventData.content_ids = [externalId];
      eventOptions = { eventID: 'atc_' + externalId + '_' + Date.now() };
    }
  }

  // 5. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ
  return _originalFbq(eventType, eventName, eventData, eventOptions);
};
```

---

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

### –¢–µ—Å—Ç –Ω–∞ alumineu.pl (2 –¥–µ–∫–∞–±—Ä—è 2024):

```
‚úÖ v16.2 FBQ Interceptor —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

üîß v16.2 –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï AddToCart: {
  from: "578757699002 (Tilda UID)",
  to: "zRy2mTY3io-ReCRagT1MI2 (External ID)",
  eventID: "atc_zRy2mTY3io-ReCRagT1MI2_1733685732739"
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ Tilda UID –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω
- ‚úÖ External ID –ø–æ–¥—Å—Ç–∞–≤–ª–µ–Ω
- ‚úÖ eventID –¥–æ–±–∞–≤–ª–µ–Ω
- ‚úÖ –°–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Meta —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

---

## üéØ –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –ß–µ—Ä–µ–∑ 24-48 —á–∞—Å–æ–≤:

```
–ë–´–õ–û (v16.1):
Product views: 47.2%
Product adds to cart: 0%        ‚ùå
Product purchases: 71.4%

–û–ñ–ò–î–ê–ï–¢–°–Ø (v16.2):
Product views: 95-100%         ‚úÖ
Product adds to cart: 95-100%  ‚úÖ
Product purchases: 95-100%     ‚úÖ
```

### –ü–æ—á–µ–º—É —É–ª—É—á—à–∏—Ç—Å—è:

1. **AddToCart** —Ç–µ–ø–µ—Ä—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å External ID ‚Üí 100% match
2. **ViewContent** –∏ **Purchase** –ø–æ–ª—É—á–∞—Ç –±–æ–ª—å—à–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö ID
3. **–û–±—â–∏–π Match Rate** –≤—ã—Ä–∞—Å—Ç–µ—Ç –¥–æ 95-100%

---

## üìÅ –§–ê–ô–õ–´

### –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:
- `dist/pl/pixel.v16.2.pl.FULL.html` (844 —Å—Ç—Ä–æ–∫–∏)
- `dist/de/pixel.v16.2.de.FULL.html` (496 —Å—Ç—Ä–æ–∫)
- `dist/ro/pixel.v16.2.ro.FULL.html` (813 —Å—Ç—Ä–æ–∫)

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- `INSTALL_V16.2_INSTRUCTIONS.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ
- `TEST_ADDTOCART_INSTRUCTIONS.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
- `dist/tools/diagnostics_addtocart_test.js` - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç

---

## üîÑ –ò–ó–ú–ï–ù–ï–ù–ò–Ø –í –ö–û–î–ï

### 1. –î–æ–±–∞–≤–ª–µ–Ω Reverse Mapping

```javascript
// –ù–û–í–û–ï –≤ v16.2
window.tildaUidToExternalId = {};
for (var parentUid in window.productCatalogMapping) {
  var mapping = window.productCatalogMapping[parentUid];
  for (var variantUid in mapping.variants) {
    window.tildaUidToExternalId[variantUid] = mapping.variants[variantUid];
  }
}
```

**–ó–∞—á–µ–º:** –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ External ID –ø–æ Tilda UID

### 2. –î–æ–±–∞–≤–ª–µ–Ω FBQ Interceptor

```javascript
// –ù–û–í–û–ï –≤ v16.2
function installFbqInterceptor() {
  var _originalFbq = window.fbq;
  
  window.fbq = function() {
    // –ü–µ—Ä–µ—Ö–≤–∞—Ç –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ AddToCart –æ—Ç Tilda
    if (eventName === 'AddToCart' && !eventOptions?.eventID) {
      // –ò—Å–ø—Ä–∞–≤–ª—è–µ–º Tilda UID ‚Üí External ID
      // –î–æ–±–∞–≤–ª—è–µ–º eventID
    }
    return _originalFbq.apply(this, arguments);
  };
}
```

**–ó–∞—á–µ–º:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –æ—Ç Tilda –Ω–∞ –ª–µ—Ç—É

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫–∞

```javascript
// –ù–û–í–û–ï –≤ v16.2
function initMetaPixelEnhanced() {
  // –ü–ï–†–í–û–ï –î–ï–ô–°–¢–í–ò–ï!
  installFbqInterceptor();
  
  // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
}
```

**–ó–∞—á–µ–º:** –ü–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –î–û —Ç–æ–≥–æ –∫–∞–∫ Tilda –≤—ã–∑–æ–≤–µ—Ç fbq

---

## ‚ö†Ô∏è –í–ê–ñ–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø

### 1. –ù–ï –æ—Ç–∫–ª—é—á–∞–π—Ç–µ Meta Pixel –≤ Tilda!

v16.2 **–∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç** —Å–æ–±—ã—Ç–∏—è Tilda, –Ω–æ –Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç –∏—Ö.  
–ï—Å–ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç—å Tilda Pixel ‚Üí —Å–æ–±—ã—Ç–∏—è –≤–æ–æ–±—â–µ –Ω–µ –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è.

### 2. –¢—Ä–µ–±—É–µ—Ç—Å—è –æ—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ v16.2:
- Ctrl+F5 (–∂–µ—Å—Ç–∫–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞)
- –ò–ª–∏ –æ—Ç–∫—Ä—ã—Ç—å –≤ —Ä–µ–∂–∏–º–µ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ

### 3. –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

v16.2 **–ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º** —Å v16.1:
- –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ v16.1 —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
- –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫
- –ú–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –Ω–∞ v16.1 –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

---

## üöÄ –°–¢–ê–¢–£–° –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–Ø

- ‚úÖ **alumineu.pl** - —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω 2 –¥–µ–∫–∞–±—Ä—è 2024, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- ‚è≥ **alumineu.de** - –≥–æ—Ç–æ–≤ –∫ —É—Å—Ç–∞–Ω–æ–≤–∫–µ
- ‚è≥ **alumineu.ro** - –≥–æ—Ç–æ–≤ –∫ —É—Å—Ç–∞–Ω–æ–≤–∫–µ

---

## üìà –ú–ï–¢–†–ò–ö–ò –î–õ–Ø –ú–û–ù–ò–¢–û–†–ò–ù–ì–ê

### –ß–µ—Ä–µ–∑ 5-10 –º–∏–Ω—É—Ç (Test Events):
- ‚úÖ AddToCart —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç —Å External ID
- ‚úÖ eventID –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ —Å–æ–±—ã—Ç–∏—è—Ö

### –ß–µ—Ä–µ–∑ 24-48 —á–∞—Å–æ–≤ (Commerce Manager):
- ‚úÖ Product adds to cart: 0% ‚Üí 95-100%
- ‚úÖ Product views: —É–ª—É—á—à–µ–Ω–∏–µ –¥–æ 95-100%
- ‚úÖ Product purchases: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ 95-100%

---

## üéì LESSONS LEARNED

### 1. Tilda –Ω–µ –≤—Å–µ–≥–¥–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è

v16.1 –ø–æ–ª–∞–≥–∞–ª—Å—è –Ω–∞ `tstore-cart-add`, –∫–æ—Ç–æ—Ä–æ–µ –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª–æ—Å—å.  
**–£—Ä–æ–∫:** –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–µ–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é.

### 2. –ü–µ—Ä–µ—Ö–≤–∞—Ç fbq - –Ω–∞–¥–µ–∂–Ω—ã–π –ø–æ–¥—Ö–æ–¥

–í–º–µ—Å—Ç–æ –æ–∂–∏–¥–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –æ—Ç Tilda, –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –≤—ã–∑–æ–≤—ã fbq –Ω–∞–ø—Ä—è–º—É—é.  
**–£—Ä–æ–∫:** –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ö–æ–¥—è—â–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–∞–º–æ–º –Ω–∏–∑–∫–æ–º —É—Ä–æ–≤–Ω–µ.

### 3. –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫—Ä–∏–ø—Ç—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã

diagnostics_addtocart_test.js –ø–æ–º–æ–≥ –Ω–∞–π—Ç–∏ —Ç–æ—á–Ω—É—é –ø—Ä–∏—á–∏–Ω—É –ø—Ä–æ–±–ª–µ–º—ã.  
**–£—Ä–æ–∫:** –ò–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É.

---

## üîó –°–í–Ø–ó–ê–ù–ù–´–ï –î–û–ö–£–ú–ï–ù–¢–´

- `PROJECT_CONTEXT.md` - –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞
- `FIX_CATALOG_MATCH.md` - –∏—Å—Ç–æ—Ä–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π Match Rate
- `reports/ANSWER_ADDTOCART_ISSUE.md` - –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã 0% AddToCart
- `reports/ADDTOCART_FIX.md` - –ø–æ–ø—ã—Ç–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è v16.1

---

**–í–µ—Ä—Å–∏—è:** v16.2 (FBQ Interceptor)  
**–î–∞—Ç–∞:** 2 –¥–µ–∫–∞–±—Ä—è 2024  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready –¥–ª—è –≤—Å–µ—Ö –ª–æ–∫–∞–ª–µ–π

