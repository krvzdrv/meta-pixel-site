/* Meta Pixel v15 â€” alumineu.pl (PLN) â€” ready to paste into Tilda before </head> */
(function(){'use strict';var CURRENCY='PLN',LOCAL_BACKUP_KEY='savedCartForPurchase_v1',LOCAL_BACKUP_TTL_MS=18e5,PURCHASE_DELAY_MS=2500,IC_CLICK_DELAY_MS=500;window.productCatalogMapping={'839319337232':{group:'lightra_x015',variants:{'839319337232':'olHJtrUhhLVDB5FN2Is6G0'}},'507661787472':{group:'lightra_x030',variants:{'507661787472':'Rv6KF1WLiPamjAv2BaZge3','500336886312':'Rv6KF1WLiPamjAv2BaZge3'}},'643951758772':{group:'lightra_x030_s',variants:{'643951758772':'MzeeWUC0gyE9JJJLbz34v3'}},'643594748902':{group:'lightra_x050',variants:{'643594748902':'wDQZybWWgNkn2Zq49zPi30'}},'169077060902':{group:'lamplix_x930',variants:{'169077060902':'63SkQfPpjSYcEKuuMh-YG2'}},'353195082562':{group:'lamplix_x950',variants:{'353195082562':'Xo7o90pXhmhKf1FmlwptL2'}},'551066399042':{group:'classix_x101',variants:{'551066399042':'rtBsri0AgIfzRs45xlYEo3'}},'749289748472':{group:'classix_x130',variants:{'749289748472':'lxFpGXGnhGh-TPEwCLiEt2'}},'920286588882':{group:'classix_x140',variants:{'920286588882':'V3cnnvOSiRXwOxWDjbAgp3'}},'177168491372':{group:'invisia_x201',variants:{'177168491372':'oo9OjTbNgZ8SJAWgghj610'}},'654200969302':{group:'invisia_x202',variants:{'654200969302':'DJNjCqquhcS8YMhhFUUT-3'}},'844835288622':{group:'invisia_x204',variants:{'844835288622':'zA59TVMAiMOOTZf15BUvl2'}},'291690637242':{group:'invisia_x206',variants:{'291690637242':'EGXmtijjgeQdvXQSqdLGi3'}},'452498958652':{group:'invisia_x207',variants:{'452498958652':'YZTju3ikgOF1-Sj6ktK6e2'}},'513604099032':{group:'invisia_x208',variants:{'513604099032':'eyVbkQihgGQtYR5EF0P4w0'}},'782187838242':{group:'invisia_x209',variants:{'782187838242':'EeRJkcybhq5xX9vhB-xzv3','451891528012':'cTT1GGAZj76alVXu4vaAe1'}},'936088518262':{group:'floatia_x301',variants:{'936088518262':'jzysdA0nhEDukcRfamitz0'}},'621394499142':{group:'floatia_x302',variants:{'621394499142':'IxT7oD8zhIbrnn2LbGw2D0','409189839232':'fxcs1s4Sg4i9usohMYyp11','344600858972':'Y7mho3jShobDY2hUqkXX83'}},'324191758802':{group:'floatia_x303',variants:{'324191758802':'VL9D-5xNhHiRwdOhXxgjl3','878695438492':'MyI2v2JMhnRtUrh6H58nz0','506291128412':'xO7PAABriJTHSKVNGiuYl3'}},'799096268472':{group:'floatia_x304',variants:{'799096268472':'OGuLhFuVjSlwHsBusU5Sf1'}},'857088138622':{group:'curtina_x402',variants:{'857088138622':'eePmEHIghXucCCjWcE2zy3','346496119032':'vdjAWIcdhHNfZhVE150J92','773490948552':'DKTDmwA2icCZL2vSUjXum3','615993668402':'e9yQf8rDjzi3XjGnnx3Iw3'}},'653795749212':{group:'curtina_x403',variants:{'653795749212':'jx2sQ0lhiTZsQVWNF9X2z0','958993098442':'34WwfpBUjupvpuPa3EpLr3','450699068972':'i3hGepcZiU3L8JqEJ2rtV0','798087718422':'Hxf-n56DhLa95Jq8oTmSb3','524584839462':'smfA9ADrg9P4AffHsiprN2','766992709062':'hSqFGvnTjaggVAymnovmh0','577296789282':'yUubMVw1hqQAZdBztKRgZ2'}},'392299768582':{group:'curtina_x404',variants:{'392299768582':'ryMNNy0Vjq1ciFgP2gUaK3','931395598192':'6UZy5OEYgiU2cDd92z2R00'}},'286691236472':{group:'curtina_x405',variants:{'967395389042':'QYtmUePthsfmVcpZ7LaHB2','418594700302':'hRYJaVIahB4Jg-O10ZpbV0','481285699772':'Rid7eYeaihDEYyuGmwIm10','544091780042':'M7K8jSGug5rmTO1txLm922','400677780532':'9YYv8DXkjKpGTTDe3j99Y3','578757699002':'zRy2mTY3io-ReCRagT1MI2'}},'720788019212':{group:'curtina_x405_m',variants:{'720788019212':'CkVvKhJbiGhhK2anvHdB33','506296378612':'iSRbWSLtitojIsPO0sI9x2','383698618452':'PIsjk6JZiDyyFLIyu2lyU0','957587119062':'gA28ToLCggK3W8YPSsFkT1'}},'754887918952':{group:'curtina_x406',variants:{'754887918952':'08Gs75cLiwndvRDfwZZkQ2','466784849032':'vdRmfjJniS9p1gOygMbDs0'}},'623692039212':{group:'curtina_x407',variants:{'623692039212':'gtIKBLtJghv4WzA42yxPP1','891397229012':'cJyPtbDhhRAmihZrojWDn0'}},'346798978752':{group:'curtina_x408',variants:{'346798978752':'FWceQ5ETivN6fBl0i-tWJ2'}},'583299109062':{group:'curtina_x409',variants:{'583299109062':'LhsJi728gSt1-qEKriOWU2'}},'967891448932':{group:'curtina_x410',variants:{'967891448932':'JLVFDRdrgtcM9IORQDzXv0'}},'473299338772':{group:'curtina_x411',variants:{'473299338772':'KmK1hPPBihH4KDyWNRaPo0'}},'698497169022':{group:'contura_x601',variants:{'698497169022':'uOmKNKiKhPZzh4UNscvrM3'}},'844699098952':{group:'stratos_x701',variants:{'844699098952':'mCMAr4yQhDaPX-LNJ5RD73','428193219112':'SJ-WVdxkgS5Fr8PVFErus3'}},'779795928932':{group:'stratos_x702',variants:{'779795928932':'A8KXwZGog4GTrG3uTcqe72','519599799052':'j0NnxjW7iJ43CUpBB1ZiA0'}},'628397029222':{group:'stratos_x703',variants:{'628397029222':'9DTMhoqug8m-s5umlvoUH2'}},'895888388892':{group:'stratos_x704',variants:{'895888388892':'5rGDU6PghnaCaAB4hbK363','479697118832':'TTCe8rd4gfNWGALqZZ6XQ1'}}};function deepClone(o){try{return JSON.parse(JSON.stringify(o))}catch(e){return null}}function waitForFbq(r){if(typeof window.fbq==='function')return r();setTimeout(function(){waitForFbq(r)},100)}function getProductData(el){if(!el)return null;var p=el.getAttribute('data-product-gen-uid'),v=el.getAttribute('data-product-uid');if(!p||!v)return null;var m=window.productCatalogMapping[p];if(!m)return null;var vid=m.variants[v],fb=false;if(!vid){vid=m.group;fb=true}var t=el.querySelector('.js-product-name, .t-name, .t-store__card__title');var pr=el.querySelector('.js-product-price, .t-store__card__price-value');return{group_id:m.group,variant_id:vid,content_name:t?t.textContent.trim():'Product',value:pr?parseFloat(String(pr.textContent).replace(/[^\d.,]/g,'').replace(',', '.')):0,fallback_used:fb}}function snapshotCartFromTilda(){var ids=[],val=0,qty=0,fb=false;if(!window.tcart||!Array.isArray(window.tcart.products)||window.tcart.products.length===0){return{content_ids:[],value:0,num_items:0,fallback_used:false,raw:null,order_id:null}}window.tcart.products.forEach(function(p){var mapped=false;if(window.productCatalogMapping){for(var puid in window.productCatalogMapping){var m=window.productCatalogMapping[puid];if(m.variants[p.uid]){ids.push(m.group,m.variants[p.uid]);mapped=true;break}}}if(!mapped){var par=window.productCatalogMapping&&window.productCatalogMapping[p.uid];if(par){var fvu=Object.keys(par.variants)[0];var vid=par.variants[fvu];ids.push(par.group,vid);mapped=true}}if(!mapped){ids.push(p.uid,p.uid);fb=true}val+=parseFloat(p.price||0)*parseInt(p.quantity||1,10);qty+=parseInt(p.quantity||1,10)});return{content_ids:ids,value:Number.isFinite(val)?Number(val):0,num_items:qty,fallback_used:fb,raw:deepClone(window.tcart),order_id:(window.tcart&&window.tcart.orderid)?String(window.tcart.orderid):null}}function persistSavedCart(c){try{localStorage.setItem(LOCAL_BACKUP_KEY,JSON.stringify({ts:Date.now(),cart:c}))}catch(e){}}function restoreSavedCart(ttl){try{var r=localStorage.getItem(LOCAL_BACKUP_KEY);if(!r)return null;var o=JSON.parse(r);if(!o||!o.cart)return null;if(ttl&&Date.now()-(o.ts||0)>ttl)return null;return o.cart}catch(e){return null}}var purchaseSent=false;function sendPurchaseEvent(d){if(purchaseSent)return;if(!d||!Array.isArray(d.content_ids)||d.content_ids.length===0)return;purchaseSent=true;var eid=d.order_id?('purchase_'+d.order_id):('purchase_'+Date.now());fbq('track','Purchase',{content_ids:d.content_ids,content_type:'product',value:Number(d.value||0),currency:CURRENCY,num_items:Number(d.num_items||0)},{eventID:eid});try{console.log('ðŸŽ‰ Purchase sent ',{value:d.value,currency:CURRENCY,num_items:d.num_items,eventID:eid,fallback_used:!!d.fallback_used})}catch(_){}}function init(){if(typeof fbq==='undefined'){setTimeout(init,100);return}function initVC(){var el=document.querySelector('[data-product-gen-uid][data-product-uid]');if(el){var pd=getProductData(el);if(pd){fbq('track','ViewContent',{content_name:pd.content_name,content_ids:[pd.group_id,pd.variant_id],content_type:'product',value:Number(pd.value||0),currency:CURRENCY})}var mo=new MutationObserver(function(ms){ms.forEach(function(m){if(m.type==='attributes'&&m.attributeName==='data-product-uid'){var npd=getProductData(el);if(npd){fbq('track','ViewContent',{content_name:npd.content_name,content_ids:[npd.group_id,npd.variant_id],content_type:'product',value:Number(npd.value||0),currency:CURRENCY})}}})});mo.observe(el,{attributes:true,attributeFilter:['data-product-uid']})}}if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',initVC)}else{initVC()}document.addEventListener('tstore-cart-add',function(){var el=document.querySelector('[data-product-gen-uid][data-product-uid]');var pd=getProductData(el);if(pd){fbq('track','AddToCart',{content_name:pd.content_name,content_ids:[pd.group_id,pd.variant_id],content_type:'product',value:Number(pd.value||0),currency:CURRENCY})}var s=snapshotCartFromTilda();if(s.content_ids.length>0){window.savedCartForPurchase=s;persistSavedCart(s)}});document.addEventListener('click',function(e){var btn=e.target&&e.target.closest('a[href*="cart"], button');if(!btn)return;var txt=(btn.textContent||'').trim().toLowerCase();if(txt.includes('dodaj')||txt.includes('kosz')||txt.includes('cart')||txt.includes('warenkorb')||txt.includes('coÈ™')||txt.includes('cos')){setTimeout(function(){var el=document.querySelector('[data-product-gen-uid][data-product-uid]');var pd=getProductData(el);if(pd){fbq('track','AddToCart',{content_name:pd.content_name,content_ids:[pd.group_id,pd.variant_id],content_type:'product',value:Number(pd.value||0),currency:CURRENCY})}var s=snapshotCartFromTilda();if(s.content_ids.length>0){window.savedCartForPurchase=s;persistSavedCart(s)}},300)}});var co=new MutationObserver(function(ms){ms.forEach(function(m){m.addedNodes&&Array.prototype.forEach.call(m.addedNodes,function(n){if(n.nodeType!==1)return;var f=n.querySelector&&n.querySelector('input[name="name"], input[name="email"], input[placeholder*="Name"], input[placeholder*="Email"]');if(f){var d=snapshotCartFromTilda();if(d.content_ids.length>0){window.savedCartForPurchase=d;persistSavedCart(d);fbq('track','InitiateCheckout',{content_ids:d.content_ids,content_type:'product',value:Number(d.value||0),currency:CURRENCY,num_items:Number(d.num_items||0)},{eventID:'ic_dom_'+Date.now()})}}})})});co.observe(document.body,{childList:true,subtree:true});document.addEventListener('click',function(e){var go=e.target&&e.target.closest('a[href*="checkout"], a[href*="#order"], a[href*="tilda/cart"], button[name="t-order"], button[data-tilda-store="checkout"], .t-store__cartwin-prodamount-wrapper .t-btn, .t706__cartwin-prodamount-wrapper .t-btn');if(!go)return;var s=snapshotCartFromTilda();if(s.content_ids.length>0){window.savedCartForPurchase=s;persistSavedCart(s)}setTimeout(function(){var d=window.savedCartForPurchase||restoreSavedCart(LOCAL_BACKUP_TTL_MS)||snapshotCartFromTilda();if(d&&d.content_ids.length>0){fbq('track','InitiateCheckout',{content_ids:d.content_ids,content_type:'product',value:Number(d.value||0),currency:CURRENCY,num_items:Number(d.num_items||0)},{eventID:'ic_click_'+Date.now()})}},IC_CLICK_DELAY_MS)});document.addEventListener('submit',function(e){var f=e.target;if(!f)return;var isCO=f.matches('.t-store__checkout-form form, form[action*="/payment"], form[action*="tilda"], form[id*="form"], form[class*="form"]')||!!f.querySelector('input[name="name"], input[name="email"], input[type="email"], input[name*="mail" i], input[name*="name" i]');if(!isCO)return;var s=snapshotCartFromTilda();if(s.content_ids.length>0){window.savedCartForPurchase=s;persistSavedCart(s)}setTimeout(function(){if(purchaseSent)return;var d=window.savedCartForPurchase||restoreSavedCart(LOCAL_BACKUP_TTL_MS)||snapshotCartFromTilda();if(d&&d.content_ids.length>0){sendPurchaseEvent(d)}},PURCHASE_DELAY_MS)},true);function trySendPurchase(){if(purchaseSent)return;var d=window.savedCartForPurchase||restoreSavedCart(LOCAL_BACKUP_TTL_MS)||snapshotCartFromTilda();if(d&&d.content_ids.length>0){sendPurchaseEvent(d)}}document.addEventListener('tildaform:success',trySendPurchase,false);document.addEventListener('tildaform:aftersuccess',trySendPurchase,false);document.addEventListener('tstore-checkout-success',trySendPurchase,false);if(document.querySelector('.t-store__thankyoupage')){setTimeout(trySendPurchase,1200)}document.addEventListener('tcart_change',function(){var s=snapshotCartFromTilda();if(s.content_ids.length>0){window.savedCartForPurchase=s;persistSavedCart(s)}});try{console.log('ðŸ”§ Meta Pixel v15 (PL) ready.')}catch(_){}}if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',function(){waitForFbq(init)})}else{waitForFbq(init)}})();
